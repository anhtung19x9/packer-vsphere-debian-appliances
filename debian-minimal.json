{
    "builders": [
      {
        "type": "vmware-iso",
        "name": "{{ user `vm_name` }}",
        "vm_name": "{{ user `vm_name` }}",
        "vmdk_name": "{{ user `vm_name` }}-disk0",
        "boot_command": [
          "<esc><wait>",
          "install <wait>",
          "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg <wait>",
          "debian-installer=en_US <wait>",
          "auto <wait>",
          "net.ifnames=0 <wait>",
          "biosdevname=0 <wait>",
          "locale=en_US <wait>",
          "kbd-chooser/method=us <wait>",
          "keyboard-configuration/xkb-keymap=us <wait>",
          "netcfg/choose_interface=eth0 <wait>",
          "netcfg/get_hostname={{ user `hostname` }} <wait>",
          "netcfg/get_domain=vmware.lab <wait>",
          "fb=false <wait>",
          "debconf/frontend=noninteractive <wait>",
          "console-setup/ask_detect=false <wait>",
          "console-keymaps-at/keymap=us <wait>",
          "<enter><wait>"
        ],
        "boot_wait": "10s",
        "headless": false,
        "vnc_disable_password": true,
        "iso_url": "{{ user `iso_url` }}",
        "iso_checksum": "{{ user `iso_checksum` }}",
        "iso_checksum_type": "{{ user `iso_checksum_type` }}",
        "http_directory": "http",
        "remote_type": "esx5",
        "remote_host": "{{ user `builder_host` }}",
        "remote_datastore": "{{ user `builder_host_datastore` }}",
        "remote_username": "{{ user `builder_host_username` }}",
        "remote_password": "{{ user `builder_host_password` }}",

        "ssh_username": "{{ user `guest_username` }}",
        "ssh_password": "{{ user `guest_password` }}",
        "ssh_port": 22,
        "ssh_timeout": "60m",
        "format": "ovf",
        "shutdown_command": "/sbin/shutdown -Ph now",
        "shutdown_timeout": "10s",
        "vmx_data": {
          "numvcpus": "{{ user `numvcpus` }}",
          "memsize": "{{ user `ramsize` }}",

          "ethernet0.networkName": "{{ user `builder_host_portgroup` }}",
          "ethernet0.present": "TRUE",
          "ethernet0.startConnected": "TRUE",
          "ethernet0.virtualDev": "vmxnet3",
          "ethernet0.addressType": "generated",
          "ethernet0.wakeOnPcktRcv": "FALSE"
        }
      }
    ],
    "provisioners": [
      {
        "type": "file",
        "source": "files/bash_profile.sh",
        "destination": "/root/.bash_profile"
      },
      {
        "type": "file",
        "source": "files/bash_prompt.sh",
        "destination": "/root/.bash_prompt"
      },
      {
        "type": "file",
        "source": "files/debian-init.py",
        "destination": "/sbin/debian-init.py"
      },
      {
        "type": "shell",
        "scripts": [
          "scripts/debian-update.sh",
          "scripts/debian-vmware.sh",
          "scripts/debian-settings.sh",
          "scripts/debian-cleanup.sh"
        ]
      }
    ],
    "post-processors": [
      {
        "type": "shell-local",
        "environment_vars": [
            "APPLIANCE_NAME={{ user `vm_name` }}",
            "APPLIANCE_VERSION={{ user `version` }}",
            "APPLIANCE_OVA={{ user `vm_name` }}_{{user `version`}}"
        ],
        "inline": [
          "cd postprocess-ova-properties",
          "./add_ovf_properties.sh"
        ]
      }
    ]
  }